<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Instrutor — Analytics | Instituto Buriti</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- CSS (paths absolutos padronizados) -->
  <link rel="stylesheet" href="/css/style.css"/>
  <link rel="stylesheet" href="/css/analytics-global.css"/>
  <link rel="stylesheet" href="/css/dashboard-instrutor.css"/>
  <!-- opcional, caso exista no seu projeto -->
  <link rel="stylesheet" href="/css/fix-logo.css"/>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Anti-flash enquanto o guard checa autenticação -->
  <style>html[data-auth="checking"] body { visibility: hidden; }</style>
  <script>document.documentElement.setAttribute('data-auth','checking');</script>

  <!-- Auth + Guard compartilhado de dashboards -->
  <script src="/js/auth.js" defer></script>
  <script src="/js/dashboard-auth.js" defer></script>

  <style>
    /* Ajustes finos locais (se precisar remover, mova para analytics-global.css) */
    .hero .hero-actions .btn { gap: .5rem; display:inline-flex; align-items:center; }
    .charts-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 24px; }
    .chart-card.full-width { grid-column: 1 / -1; }
    .breadcrumb { padding: 12px 0; font-size: 14px; color: #6c757d; }
    .breadcrumb a { color: inherit; text-decoration: none; }
    .status-online{background:#22c55e;border-radius:999px;width:10px;height:10px;position:absolute;right:4px;bottom:4px;border:2px solid #fff;}
    .avatar-img{width:72px;height:72px;border-radius:999px;object-fit:cover}
    .profile-avatar{position:relative}
    .filter-select,.filter-input{width:100%}
    .filter-group{min-width:180px}
    .filters-grid,.filters-panel{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:16px;align-items:end}
    @media (max-width: 980px){
      .charts-grid{grid-template-columns:1fr}
      .filters-grid,.filters-panel{grid-template-columns:repeat(2,minmax(0,1fr))}
    }
  </style>
</head>

<body class="dashboard-body" data-dashboard-role="instrutor">
  <!-- Header padronizado -->
  <header class="header">
    <nav class="nav">
      <div class="nav-item"><a href="/index.html">Home</a></div>
      <div class="nav-item"><a href="/pages/biblioteca-cursos.html">Cursos</a></div>
      <div class="nav-item"><a href="/pages/quem-somos.html">Quem Somos</a></div>
      <div class="nav-item"><a href="/pages/seja-instrutor-novo.html">Seja um Instrutor</a></div>
      <div class="nav-item"><a href="/pages/contato.html">Contato</a></div>

      <div class="nav-item login-dropdown">
        <button class="login-btn user-name" type="button" aria-haspopup="true" aria-expanded="false" data-static="false">Minha conta</button>
        <div class="dropdown-menu">
          <a href="/pages/dashboard-instrutor.html" class="dropdown-item">Dashboard</a>
          <a href="#logout" class="dropdown-item" id="logoutLink">Sair</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Breadcrumb -->
  <div class="container">
    <div class="breadcrumb">
      <a href="/index.html">Início</a> <span class="separator">→</span>
      <a href="/pages/dashboard-instrutor.html">Dashboard</a> <span class="separator">→</span>
      <span class="current">Analytics</span>
    </div>
  </div>

  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1>Dashboard do Instrutor — Analytics</h1>
        <p>Acompanhe o desempenho dos seus cursos, engajamento dos alunos e métricas de ensino em tempo real.</p>
        <div class="hero-actions">
          <a href="#metrics" class="btn btn-primary"><i class="fas fa-chart-line"></i> Ver Métricas</a>
          <a href="#courses" class="btn btn-outline"><i class="fas fa-book"></i> Meus Cursos</a>
          <a href="#reports" class="btn btn-outline"><i class="fas fa-file-alt"></i> Relatórios</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Perfil do instrutor -->
  <section class="instructor-profile">
    <div class="container">
      <div class="profile-card">
        <div class="profile-avatar">
          <img class="avatar-img" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face" alt="Instrutor(a)">
          <div class="status-indicator status-online"></div>
        </div>
        <div class="profile-info">
          <h2 data-user-name>Instrutor(a)</h2>
          <p class="profile-title">Especialista em Ensino</p>
          <div class="profile-stats">
            <div class="stat-item"><span class="stat-value">3</span><span class="stat-label">Cursos Ativos</span></div>
            <div class="stat-item"><span class="stat-value">127</span><span class="stat-label">Alunos</span></div>
            <div class="stat-item"><span class="stat-value">4.8</span><span class="stat-label">Avaliação</span></div>
            <div class="stat-item"><span class="stat-value">R$ 15.400</span><span class="stat-label">Receita Mensal</span></div>
          </div>
        </div>
        <div class="profile-actions">
          <button class="btn btn-primary"><i class="fas fa-edit"></i> Editar Perfil</button>
          <button class="btn btn-outline"><i class="fas fa-eye"></i> Ver Perfil Público</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Filtros -->
  <section class="filters-section">
    <div class="container">
      <div class="filters-card">
        <div class="filters-grid">
          <div class="filter-group">
            <label for="period-filter">Período</label>
            <select id="period-filter" class="filter-select">
              <option value="7">Últimos 7 dias</option>
              <option value="30" selected>Últimos 30 dias</option>
              <option value="90">Últimos 3 meses</option>
              <option value="365">Último ano</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="course-filter">Curso</label>
            <select id="course-filter" class="filter-select">
              <option value="">Todos os Cursos</option>
              <option value="marketing">Marketing Digital para Educadores</option>
              <option value="content">Estratégias de Conteúdo</option>
              <option value="social">Redes Sociais para Professores</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="metric-filter">Métrica</label>
            <select id="metric-filter" class="filter-select">
              <option value="">Todas as Métricas</option>
              <option value="engagement">Engajamento</option>
              <option value="completion">Conclusão</option>
              <option value="revenue">Receita</option>
              <option value="ratings">Avaliações</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="search-filter">Buscar</label>
            <input id="search-filter" type="text" class="filter-input" placeholder="Buscar alunos, atividades..."/>
          </div>
          <div class="filter-actions">
            <button class="btn btn-outline btn-sm" id="resetFilters"><i class="fas fa-times"></i> Limpar</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Métricas em cards -->
  <section class="metrics-section" id="metrics">
    <div class="container">
      <div class="metrics-grid">
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-users"></i></div><div class="metric-content"><div class="metric-value">127</div><div class="metric-label">Alunos Ativos</div><div class="metric-change positive">+8 esta semana</div></div></div>
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-book"></i></div><div class="metric-content"><div class="metric-value">3</div><div class="metric-label">Cursos Publicados</div><div class="metric-change positive">+1 este mês</div></div></div>
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-star"></i></div><div class="metric-content"><div class="metric-value">4.8</div><div class="metric-label">Avaliação Média</div><div class="metric-change positive">+0.2 este mês</div></div></div>
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-percentage"></i></div><div class="metric-content"><div class="metric-value">78%</div><div class="metric-label">Taxa de Conclusão</div><div class="metric-change positive">+5% este mês</div></div></div>
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-dollar-sign"></i></div><div class="metric-content"><div class="metric-value">R$ 15.400</div><div class="metric-label">Receita Mensal</div><div class="metric-change positive">+12% este mês</div></div></div>
        <div class="metric-card"><div class="metric-icon"><i class="fas fa-clock"></i></div><div class="metric-content"><div class="metric-value">2h 34min</div><div class="metric-label">Tempo Médio de Estudo</div><div class="metric-change positive">+15min esta semana</div></div></div>
      </div>
    </div>
  </section>

  <!-- Gráficos -->
  <section class="charts-section">
    <div class="container">
      <div class="charts-grid">
        <!-- Engajamento -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Engajamento dos Alunos</h3>
            <div class="chart-tabs">
              <button class="tab-btn active" data-period="daily">Diário</button>
              <button class="tab-btn" data-period="weekly">Semanal</button>
              <button class="tab-btn" data-period="monthly">Mensal</button>
            </div>
          </div>
          <div class="chart-container"><canvas id="engagementChart"></canvas></div>
          <div class="engagement-stats">
            <div class="stat-item"><span class="stat-value">89%</span><span class="stat-label">Participação em Aulas</span></div>
            <div class="stat-item"><span class="stat-value">76%</span><span class="stat-label">Entrega de Atividades</span></div>
            <div class="stat-item"><span class="stat-value">92%</span><span class="stat-label">Interação em Fóruns</span></div>
          </div>
        </div>

        <!-- Performance dos cursos -->
        <div class="chart-card">
          <div class="chart-header">
            <h3>Performance dos Cursos</h3>
            <div class="chart-tabs">
              <button class="tab-btn active" data-metric="students">Alunos</button>
              <button class="tab-btn" data-metric="completion">Conclusão</button>
              <button class="tab-btn" data-metric="revenue">Receita</button>
            </div>
          </div>
          <div class="chart-container"><canvas id="performanceChart"></canvas></div>
        </div>

        <!-- Receita (full width) -->
        <div class="chart-card full-width">
          <div class="chart-header">
            <h3>Tendência de Receita</h3>
            <div class="chart-tabs">
              <button class="tab-btn active" data-view="revenue">Receita</button>
              <button class="tab-btn" data-view="enrollments">Matrículas</button>
              <button class="tab-btn" data-view="certificates">Certificados</button>
            </div>
          </div>
          <div class="chart-container"><canvas id="revenueChart"></canvas></div>
          <div class="revenue-breakdown">
            <div class="breakdown-item"><div><div class="breakdown-label">Curso Principal</div><div class="breakdown-value">R$ 8.900</div></div><div class="breakdown-percent">58%</div></div>
            <div class="breakdown-item"><div><div class="breakdown-label">Curso Secundário</div><div class="breakdown-value">R$ 4.200</div></div><div class="breakdown-percent">27%</div></div>
            <div class="breakdown-item"><div><div class="breakdown-label">Curso Novo</div><div class="breakdown-value">R$ 2.300</div></div><div class="breakdown-percent">15%</div></div>
          </div>
        </div>

        <!-- Avaliações -->
        <div class="chart-card">
          <div class="chart-header"><h3>Avaliações dos Alunos</h3></div>
          <div class="chart-container"><canvas id="ratingsChart"></canvas></div>
          <div class="ratings-summary">
            <div class="rating-item"><div class="rating-stars">★★★★★</div><div class="rating-count">89 avaliações</div></div>
            <div class="rating-item"><div class="rating-stars">★★★★☆</div><div class="rating-count">23 avaliações</div></div>
            <div class="rating-item"><div class="rating-stars">★★★☆☆</div><div class="rating-count">8 avaliações</div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Meus cursos -->
  <section class="my-courses-section" id="courses">
    <div class="container">
      <div class="section-header">
        <h2>Meus Cursos</h2>
        <div class="section-actions">
          <button class="btn btn-primary"><i class="fas fa-plus"></i> Criar Novo Curso</button>
          <button class="btn btn-outline"><i class="fas fa-download"></i> Exportar Dados</button>
        </div>
      </div>

      <div class="courses-grid">
        <!-- Card 1 -->
        <div class="course-card">
          <div class="course-header">
            <span class="course-status status-active">Ativo</span>
            <div class="course-actions">
              <button class="btn btn-sm btn-outline" title="Editar"><i class="fas fa-edit"></i></button>
              <button class="btn btn-sm btn-outline" title="Estatísticas"><i class="fas fa-chart-line"></i></button>
              <button class="btn btn-sm btn-outline" title="Mais"><i class="fas fa-ellipsis-v"></i></button>
            </div>
          </div>
          <div class="course-content">
            <h4>Marketing Digital para Educadores</h4>
            <p>Estratégias de marketing digital aplicadas ao contexto educacional.</p>
            <div class="course-stats">
              <div class="stat"><span class="stat-value">64</span><span class="stat-label">Alunos</span></div>
              <div class="stat"><span class="stat-value">71%</span><span class="stat-label">Conclusão</span></div>
              <div class="stat"><span class="stat-value">4.4</span><span class="stat-label">Avaliação</span></div>
              <div class="stat"><span class="stat-value">R$ 7.680</span><span class="stat-label">Receita</span></div>
            </div>
            <div class="course-progress">
              <div class="progress-bar"><div class="progress-fill" style="width:71%"></div></div>
              <span class="progress-text">71% de conclusão média</span>
            </div>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="course-card">
          <div class="course-header">
            <span class="course-status status-active">Ativo</span>
            <div class="course-actions">
              <button class="btn btn-sm btn-outline" title="Editar"><i class="fas fa-edit"></i></button>
              <button class="btn btn-sm btn-outline" title="Estatísticas"><i class="fas fa-chart-line"></i></button>
              <button class="btn btn-sm btn-outline" title="Mais"><i class="fas fa-ellipsis-v"></i></button>
            </div>
          </div>
          <div class="course-content">
            <h4>Estratégias de Conteúdo Digital</h4>
            <p>Criação de conteúdo envolvente para plataformas digitais educacionais.</p>
            <div class="course-stats">
              <div class="stat"><span class="stat-value">38</span><span class="stat-label">Alunos</span></div>
              <div class="stat"><span class="stat-value">84%</span><span class="stat-label">Conclusão</span></div>
              <div class="stat"><span class="stat-value">4.7</span><span class="stat-label">Avaliação</span></div>
              <div class="stat"><span class="stat-value">R$ 4.560</span><span class="stat-label">Receita</span></div>
            </div>
            <div class="course-progress">
              <div class="progress-bar"><div class="progress-fill" style="width:84%"></div></div>
              <span class="progress-text">84% de conclusão média</span>
            </div>
          </div>
        </div>

        <!-- Card 3 (rascunho) -->
        <div class="course-card">
          <div class="course-header">
            <span class="course-status status-draft">Rascunho</span>
            <div class="course-actions">
              <button class="btn btn-sm btn-outline" title="Editar"><i class="fas fa-edit"></i></button>
              <button class="btn btn-sm btn-outline" title="Prévia"><i class="fas fa-eye"></i></button>
              <button class="btn btn-sm btn-outline" title="Mais"><i class="fas fa-ellipsis-v"></i></button>
            </div>
          </div>
          <div class="course-content">
            <h4>Redes Sociais para Professores</h4>
            <p>Uso estratégico de redes sociais para ampliar o alcance educacional.</p>
            <div class="course-stats">
              <div class="stat"><span class="stat-value">-</span><span class="stat-label">Alunos</span></div>
              <div class="stat"><span class="stat-value">-</span><span class="stat-label">Conclusão</span></div>
              <div class="stat"><span class="stat-value">-</span><span class="stat-label">Avaliação</span></div>
              <div class="stat"><span class="stat-value">R$ 0</span><span class="stat-label">Receita</span></div>
            </div>
            <div class="course-progress">
              <div class="progress-bar"><div class="progress-fill" style="width:65%"></div></div>
              <span class="progress-text">65% do conteúdo criado</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Footer padronizado -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <img src="/images/LogomarcaInstitutoBuriti.png" alt="Instituto Buriti" class="footer-logo"/>
          <h3>Educação que transforma. Cultura que conecta.</h3>
          <p>Instituto Buriti, uma empresa 100% digital.</p>
        </div>
        <div class="footer-links">
          <div class="footer-column">
            <h4>Links Rápidos</h4>
            <ul>
              <li><a href="/index.html">Home</a></li>
              <li><a href="/pages/quem-somos.html">Quem Somos</a></li>
              <li><a href="/pages/cursos.html">Cursos</a></li>
              <li><a href="/pages/seja-instrutor-novo.html">Seja um Instrutor</a></li>
              <li><a href="/pages/contato.html">Contato</a></li>
            </ul>
          </div>
          <div class="footer-column">
            <h4>Contato</h4>
            <ul>
              <li>📧 contato@institutoburiti.com.br</li>
              <li>📞 (86) 98170-8388</li>
              <li>📍 Teresina, Piauí</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="footer-bottom"><p>&copy; 2024 Instituto Buriti. Todos os direitos reservados.</p></div>
    </div>
  </footer>

  <!-- Scripts locais -->
  <script>
    // ===== Guarda mínima por papel ('instrutor') usando authManager =====
    document.addEventListener('DOMContentLoaded', () => {
      const mgr = window.authManager;
      if (!mgr || !mgr.isAuthenticated() || String((mgr.getUser()?.role || mgr.getUser()?.type || '')).toLowerCase() !== 'instrutor') {
        window.location.replace('/pages/login-instrutor.html');
        return;
      }

      // Hidratar nome no header/perfil
      const displayName = mgr.getUser().name || mgr.getUser().email || 'Instrutor(a)';
      document.querySelectorAll('[data-user-name], .login-dropdown .login-btn').forEach(el => {
        if (!el.hasAttribute('data-static')) el.textContent = displayName;
      });

      // Logout (funciona também pelo dashboard-auth via delegação)
      document.getElementById('logoutLink')?.addEventListener('click', (e) => {
        e.preventDefault();
        mgr.logout({ redirect: '/pages/login-instrutor.html' });
      });
    });

    // ===== Gráficos (dados estáticos para layout; ligue com API depois) =====
    function makeLineChart(ctx, labels, data, label){
      return new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ label, data, tension: .35, fill: false }]},
        options: { responsive: true, maintainAspectRatio: false, plugins:{legend:{display:false}} }
      });
    }
    function makeBarChart(ctx, labels, data, label){
      return new Chart(ctx, {
        type: 'bar',
        data: { labels, datasets: [{ label, data }]},
        options: { responsive: true, maintainAspectRatio: false, plugins:{legend:{display:false}} }
      });
    }
    function makeDoughnutChart(ctx, labels, data){
      return new Chart(ctx, {
        type: 'doughnut',
        data: { labels, datasets: [{ data }]},
        options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Engajamento
      const engCtx = document.getElementById('engagementChart');
      if (engCtx) makeLineChart(engCtx, ['Seg','Ter','Qua','Qui','Sex','Sáb','Dom'], [82,86,88,91,90,87,89], 'Engajamento');

      // Performance
      const perfCtx = document.getElementById('performanceChart');
      if (perfCtx) makeBarChart(perfCtx, ['Curso A','Curso B','Curso C'], [64,38,12], 'Alunos');

      // Receita
      const revCtx = document.getElementById('revenueChart');
      if (revCtx) makeLineChart(revCtx, ['Jan','Fev','Mar','Abr','Mai','Jun'], [2100,2800,2600,3100,3600,4300], 'Receita');

      // Avaliações
      const ratCtx = document.getElementById('ratingsChart');
      if (ratCtx) makeDoughnutChart(ratCtx, ['5★','4★','3★','2★','1★'], [89,23,8,3,1]);

      // Tabs (comportamento visual)
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const group = btn.parentElement.querySelectorAll('.tab-btn');
          group.forEach(b=>b.classList.toggle('active', b===btn));
        });
      });

      // Limpar filtros
      document.getElementById('resetFilters')?.addEventListener('click', ()=>{
        document.getElementById('period-filter').value = '30';
        document.getElementById('course-filter').value = '';
        document.getElementById('metric-filter').value = '';
        document.getElementById('search-filter').value = '';
      });
    });
  </script>
</body>
</html>